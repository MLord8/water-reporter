<!DOCTYPE html>
<html>
<head>
	<title>Water Reporter</title>
	<meta name="viewport" content="initial-scale=1.0">
	<meta charset="utf-8">
	<!-- <style>
		/* Always set the map height explicitly to define the size of the div
		* element that contains the map. */
		#map {
		height: 100%;
		}
		/* Optional: Makes the sample page fill the window. */
		html, body {
		height: 100%;
		margin: 0;
		padding: 0;
		}
    </style> -->
    <style>
       #map {
        height: 600px;
        width: 840px;
       }
    </style>
    <script src="https://www.gstatic.com/firebasejs/3.8.0/firebase.js"></script>
    <script src="scripts.js"></script>
</head>

<!-- <body onload="getWaterReports()"> -->
<body>
  <h1>Welcome to Water Reporter!</h1>
  <div>
  	<button onclick="window.location.href='profile.html'">View Profile</button>
  	<button onclick="window.location.href='waterreport.html'">Submit Water Report</button>
  	<button onclick="window.location.href='purityreport.html'">Submit Water Purity Report</button>
  	<button onclick="window.location.href='graph.html'">Purity Trends</button>
  	<button onclick="window.location.href='login.html'">Logout</button>
  </div>
  <br>
	<div id="map"></div>
	<!-- <script>
		var map;
		function initMap() {
		map = new google.maps.Map(document.getElementById('map'), {
			center: {lat: -34.397, lng: 150.644},
			zoom: 8
		});
		}
	</script> -->
	
	<script>
		setUser(JSON.parse(sessionStorage.getItem('currentUser')));
	    function initMap() {
	      	var map = new google.maps.Map(document.getElementById('map'), {
	      		zoom: 2,
	      		center: {lat: 0, lng: 0}
	      	});
	      	var strictBounds = new google.maps.LatLngBounds(
				new google.maps.LatLng(-45, -90),
				new google.maps.LatLng(45, 90) 
			);
			map.fitBounds(strictBounds);
	      	// map.fitBounds(new google.maps.LatLng(-45, -90), new google.maps.LatLng(45,90));
	      	var waterReports = [];
	      	var geocoder = new google.maps.Geocoder();

	      	var getWaterReps = function(otherStuff) {
	      		var interval = setInterval(function() {
	      			waterReports = getWaterReports();
	      			if (waterReports.length != 0) {
	      				clearInterval(interval);
	      				otherStuff(waterReports);
	      			}
	      		});
	      	}

	      	getWaterReps(function() {
	      		waterReports.forEach(function(report) {
					geocoder.geocode({address: report['addressStr']}, function(results, status) {
						if (status == google.maps.GeocoderStatus.OK) {
							// console.log(results.length);
							// console.log(results[0].geometry.location);
							var marker = new google.maps.Marker({
								map: map,
								title: "Title",
								position: results[0].geometry.location
							})
						} else {
							console.log("Unsuccessful address for reportNumber: " + report['reportNumber']);
						}
					});
	      			// console.log(report['reportNumber']);
	      			// console.log(report);
	      		});
	      	});

	      	// waterReports.forEach(function(report) {
	      	// 	console.log("hi");
	      	// });

	      	// function getCoordinates(report) {
		      // 	var geocoder = new google.maps.Geocoder();
		      // 	geocoder.gecode({address: address}, function(results, status) {
		      // 		if (status == google.maps.GeocoderStatus.OK) {
		      // 			console.log(results[0]);
		      // 		} else {
		      // 			console.log("Unsuccessful address for reportNum: " + report['reportNum']);
		      // 		}
		      // 	});
	      	// }

	      	
	        // var uluru = {lat: -25.363, lng: 131.044};
	        // var map = new google.maps.Map(document.getElementById('map'), {
	        //   zoom: 2,
	        //   center: uluru
	        // });
	        // var marker = new google.maps.Marker({
	        //   position: uluru,
	        //   map: map
	        // });

      }
    </script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAKI3rpMb8mTAen_Hae3ZcO1uUeI0g-lLA&callback=initMap"></script>
</body>
</html>
